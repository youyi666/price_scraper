<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能客服质检看板 (演示版)</title>
    <!-- 1. 引入 Tailwind CSS (样式库) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. 引入 图标库 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif; }
        .chat-bubble-kf { background-color: #2563eb; color: white; border-top-right-radius: 0; }
        .chat-bubble-user { background-color: white; border: 1px solid #e2e8f0; border-top-left-radius: 0; }
        /* 滚动条美化 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <!-- 顶部导航 -->
    <div class="bg-white border-b px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-10">
        <div class="flex items-center gap-3">
            <div class="p-2 bg-blue-600 rounded-lg">
                <i data-lucide="bar-chart-3" class="w-6 h-6 text-white"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold text-slate-800">智能客服质检看板</h1>
                <p class="text-xs text-slate-500">数据日期: 2026-01-05</p>
            </div>
        </div>
        <div class="flex gap-4">
            <div class="text-right">
                <p class="text-sm text-slate-500">今日接待</p>
                <p class="font-bold text-xl" id="total-users">-</p>
            </div>
            <div class="h-10 w-px bg-slate-200"></div>
            <div class="text-right">
                <p class="text-sm text-slate-500">平均分</p>
                <p class="font-bold text-xl text-orange-500" id="avg-score">-</p>
            </div>
        </div>
    </div>

    <!-- 主内容区 -->
    <div class="p-6 max-w-[1400px] mx-auto grid grid-cols-12 gap-6">
        
        <!-- 左侧：核心看板 (8列) -->
        <div class="col-span-12 lg:col-span-8 space-y-6">
            
            <!-- 核心指标卡片 -->
            <div class="grid grid-cols-3 gap-4">
                <!-- 黑榜卡片 -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex items-center gap-4">
                    <div class="p-3 bg-red-100 text-red-600 rounded-full">
                        <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-sm text-slate-500">需要关注 (黑榜)</p>
                        <p class="text-2xl font-bold text-red-600" id="risk-count">-</p>
                    </div>
                </div>
                <!-- 红榜卡片 -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex items-center gap-4">
                    <div class="p-3 bg-green-100 text-green-600 rounded-full">
                        <i data-lucide="thumbs-up" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-sm text-slate-500">优秀范例 (红榜)</p>
                        <p class="text-2xl font-bold text-green-600" id="excellent-count">-</p>
                    </div>
                </div>
                <!-- 响应时间卡片 -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex items-center gap-4">
                    <div class="p-3 bg-blue-100 text-blue-600 rounded-full">
                        <i data-lucide="clock" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-sm text-slate-500">平均响应时间</p>
                        <p class="text-2xl font-bold text-slate-800" id="avg-time">-</p>
                    </div>
                </div>
            </div>

            <!-- 黑榜列表 -->
            <div class="bg-white rounded-xl shadow-sm border border-red-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-red-50 bg-red-50/50 flex justify-between items-center">
                    <h2 class="font-bold text-red-800 flex items-center gap-2">
                        <i data-lucide="alert-octagon" class="w-5 h-5"></i>
                        急需改进 (黑榜 TOP)
                    </h2>
                    <span class="text-xs px-2 py-1 bg-white rounded border border-red-200 text-red-600">优先处理</span>
                </div>
                <div id="risk-list" class="divide-y divide-slate-100">
                    <!-- JS动态填充 -->
                </div>
            </div>

            <!-- 红榜列表 -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-slate-50 flex justify-between items-center">
                    <h2 class="font-bold text-green-700 flex items-center gap-2">
                        <i data-lucide="check-circle-2" class="w-5 h-5"></i>
                        优秀范例 (红榜 TOP)
                    </h2>
                </div>
                <div id="excellent-list" class="grid grid-cols-1 divide-y divide-slate-100">
                    <!-- JS动态填充 -->
                </div>
            </div>
        </div>

        <!-- 右侧：详情与绩效 (4列) -->
        <div class="col-span-12 lg:col-span-4 space-y-6">
            
            <!-- 1. 绩效表 -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-4">
                <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i data-lucide="user" class="w-5 h-5 text-blue-500"></i>
                    昨日绩效概览
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-slate-500 bg-slate-50 uppercase">
                            <tr>
                                <th class="px-2 py-2">客服</th>
                                <th class="px-2 py-2 text-center">接待</th>
                                <th class="px-2 py-2 text-center">均分</th>
                                <th class="px-2 py-2 text-right">时效</th>
                            </tr>
                        </thead>
                        <tbody id="agent-table" class="divide-y divide-slate-100">
                            <!-- JS动态填充 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 2. 对话详情展示区 (Sticky) -->
            <div id="chat-detail-container" class="sticky top-24 bg-white rounded-xl shadow-lg border border-blue-200 flex flex-col h-[600px] hidden">
                <!-- 头部 -->
                <div class="p-4 border-b bg-blue-50/50 flex justify-between items-center rounded-t-xl">
                    <div>
                        <h3 class="font-bold text-slate-800 flex items-center gap-2">
                            <i data-lucide="message-square" class="w-4 h-4"></i> 对话回溯
                        </h3>
                        <p class="text-xs text-slate-500" id="detail-meta">加载中...</p>
                    </div>
                    <button onclick="closeDetail()" class="p-1 hover:bg-slate-200 rounded-full">
                        <i data-lucide="x-circle" class="w-5 h-5 text-slate-400"></i>
                    </button>
                </div>
                
                <!-- 聊天记录区域 -->
                <div id="detail-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50">
                    <!-- 消息动态填充 -->
                </div>
                
                <!-- AI建议区域 -->
                <div class="p-4 border-t bg-white rounded-b-xl border-t-2 border-red-100">
                    <p class="text-xs font-bold text-slate-500 mb-1 flex items-center gap-1">
                        <i data-lucide="bot" class="w-4 h-4"></i> AI 改进建议:
                    </p>
                    <p class="text-sm text-slate-700 font-medium" id="detail-advice">-</p>
                </div>
            </div>

            <!-- 空状态提示 -->
            <div id="empty-state" class="bg-slate-100 rounded-xl border border-dashed border-slate-300 h-40 flex flex-col gap-2 items-center justify-center text-slate-400 text-sm">
                <i data-lucide="mouse-pointer-click" class="w-6 h-6"></i>
                <p>点击左侧红/黑榜查看对话详情</p>
            </div>

        </div>
    </div>

    <script>
        // ==========================================
        // 1. 模拟数据 (真实场景下从 dashboard_data.json 读取)
        // ==========================================
        const MOCK_DATA = {
            summary: {
                total_users: 10, total_messages: 142, avg_score: 6.8, avg_response_time: 42.5, risk_count: 2, excellent_count: 3
            },
            agent_stats: [
                { name: "viomi小甜心", chats: 2, avg_score: 6.0, avg_time: 25.4 },
                { name: "viomi米小颖MKD", chats: 2, avg_score: 5.5, avg_time: 58.2 },
                { name: "viomi小仙女", chats: 1, avg_score: 6.0, avg_time: 32.1 },
                { name: "viomi米小锋MKD", chats: 1, avg_score: 6.0, avg_time: 45.0 },
                { name: "Viomi米萌mk10", chats: 1, avg_score: 7.0, avg_time: 38.5 },
                { name: "viomi小云朵", chats: 2, avg_score: 7.5, avg_time: 40.2 },
            ],
            details: [
                {
                    id: "1", customer: "春***", agent: "viomi小甜心", score: 3,
                    tags: ["严重冲突", "用户辱骂"], time: "2026-01-05",
                    summary: "用户情绪极度激动，使用辱骂性语言质疑企业文化和售后。",
                    advice: "客服虽然保持了礼貌，但话术过于官方，未能有效降火。建议暂停使用可爱语气助词，直接转接高级售后专员。",
                    is_risk: true,
                    messages: [
                        { role: "用户", content: "妈的那么多新人都用在玩顾客身上，靠你妈什么企文化。" },
                        { role: "客服", content: "小云朵~~我们这边云米旗舰店，出售的商品都是官方正品..." },
                        { role: "用户", content: "我我我向你求证一个官方已经确认的东西，你还给我逼逼玩心眼。" }
                    ]
                },
                {
                    id: "2", customer: "3***", agent: "viomi小甜心", score: 9,
                    tags: ["销售机会", "引导好评"], time: "2026-01-02",
                    summary: "用户主动索要赠品（测试笔），客服灵活应对，引导晒图后赠送。",
                    advice: "处理得当，利用赠品需求成功锁定用户好评（晒图），值得推广的话术。",
                    is_excellent: true,
                    messages: [
                        { role: "用户", content: "拍完了，给带个测试笔" },
                        { role: "客服", content: "好哒到货嗮图的联系我们哈" },
                        { role: "用户", content: "安装完以后再给呀" }
                    ]
                },
                {
                    id: "3", customer: "慢***", agent: "viomi米小锋MKD", score: 6,
                    tags: ["响应迟缓", "流程生疏"], time: "2026-01-05",
                    summary: "用户询问换货发货进度，客服查询时间较长，回复不够笃定。",
                    advice: "查询订单状态应更迅速，不要让用户长时间等待'小妹看看'的结果。",
                    messages: [
                        { role: "用户", content: "你好，我的机器已经寄走，换货的机器什么时候发货" },
                        { role: "客服", content: "这边小妹看看哦" },
                        { role: "用户", content: "？？" }
                    ]
                },
                {
                    id: "4", customer: "邓***", agent: "viomi米小颖MKD", score: 5,
                    tags: ["答非所问", "机械回复"], time: "2026-01-05",
                    summary: "用户问发货城市，客服先发图片再让用户自己看物流，体验不佳。",
                    advice: "简单问题（如哪里发货）应直接回答城市名，而不是丢图片或让用户自己查。",
                    messages: [
                        { role: "用户", content: "哪个城市发出" },
                        { role: "客服", content: "[图片]" },
                        { role: "用户", content: "广东佛山吗" }
                    ]
                },
                {
                    id: "5", customer: "f***", agent: "viomi米小锂MKD", score: 4,
                    tags: ["用户失望", "退货风险"], time: "2026-01-03",
                    summary: "用户表示'无语'，'不用劳民伤财'，有强烈退货或拒收意向。",
                    advice: "用户已经表现出强烈失望，常规的道歉话术显得苍白。需要主管介入了解具体失望原因。",
                    is_risk: true,
                    messages: [
                        { role: "用户", content: "无语" },
                        { role: "客服", content: "真的不好意思...以后会改善做的更好的..." },
                        { role: "用户", content: "不行就不用拒收了吧" }
                    ]
                },
                {
                    id: "6", customer: "秋***", agent: "viomi小云朵", score: 8,
                    tags: ["业务熟练"], time: "2026-01-04",
                    summary: "用户询问废水率，客服回答准确。",
                    advice: "继续保持。",
                    is_excellent: true,
                    messages: [
                        { role: "用户", content: "这个废水率是多少" },
                        { role: "客服", content: "2比1的哈" }
                    ]
                }
            ]
        };

        // ==========================================
        // 2. 渲染逻辑
        // ==========================================
        
        // 渲染顶部统计
        document.getElementById('total-users').innerText = MOCK_DATA.summary.total_users + "人";
        document.getElementById('avg-score').innerText = MOCK_DATA.summary.avg_score;
        document.getElementById('avg-time').innerText = MOCK_DATA.summary.avg_response_time + "s";
        document.getElementById('risk-count').innerText = MOCK_DATA.summary.risk_count + " 例";
        document.getElementById('excellent-count').innerText = MOCK_DATA.summary.excellent_count + " 例";

        // 渲染列表函数
        function renderList(containerId, items, isRisk) {
            const container = document.getElementById(containerId);
            items.forEach(item => {
                const tagHtml = item.tags.map(tag => 
                    `<span class="px-2 py-0.5 text-xs rounded-full font-medium ${isRisk ? 'bg-red-100 text-red-700' : 'bg-blue-50 text-blue-600'}">${tag}</span>`
                ).join('');
                
                const div = document.createElement('div');
                div.className = `p-4 transition-colors cursor-pointer border-l-4 ${isRisk ? 'hover:bg-red-50/50 border-transparent hover:border-red-400' : 'hover:bg-green-50/50 border-transparent hover:border-green-400'}`;
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-slate-700">${item.agent}</span>
                            <span class="text-xs text-slate-400">vs</span>
                            <span class="text-sm text-slate-600">${item.customer}</span>
                            ${!isRisk ? `<span class="ml-2 text-xs px-2 py-0.5 bg-green-100 text-green-700 rounded-full font-bold">${item.score}分</span>` : ''}
                        </div>
                        <div class="flex gap-1">${tagHtml}</div>
                    </div>
                    <p class="text-sm text-slate-600 mb-2 line-clamp-1">${item.summary}</p>
                    ${isRisk ? `
                    <div class="bg-slate-50 p-2 rounded text-xs text-slate-500 relative mt-2">
                        <span class="font-bold text-red-500">建议：</span>${item.advice}
                    </div>` : ''}
                `;
                div.onclick = () => showDetail(item);
                container.appendChild(div);
            });
        }

        // 渲染黑榜和红榜
        const riskItems = MOCK_DATA.details.filter(d => d.score < 6 || d.is_risk);
        const excellentItems = MOCK_DATA.details.filter(d => d.score >= 8 || d.is_excellent);
        
        renderList('risk-list', riskItems, true);
        renderList('excellent-list', excellentItems, false);

        // 渲染绩效表
        const agentTable = document.getElementById('agent-table');
        MOCK_DATA.agent_stats.sort((a,b) => b.avg_score - a.avg_score).forEach(agent => {
            const tr = document.createElement('tr');
            tr.className = "hover:bg-slate-50";
            tr.innerHTML = `
                <td class="px-2 py-2 font-medium truncate max-w-[100px]">${agent.name}</td>
                <td class="px-2 py-2 text-center text-slate-500">${agent.chats}</td>
                <td class="px-2 py-2 text-center font-bold ${agent.avg_score >= 7 ? 'text-green-600' : 'text-orange-500'}">${agent.avg_score}</td>
                <td class="px-2 py-2 text-right text-slate-500">${agent.avg_time}s</td>
            `;
            agentTable.appendChild(tr);
        });

        // ==========================================
        // 3. 交互逻辑
        // ==========================================
        function showDetail(chat) {
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('chat-detail-container').classList.remove('hidden');
            
            // 填充头部信息
            document.getElementById('detail-meta').innerText = `${chat.time} | 客户: ${chat.customer} | 客服: ${chat.agent}`;
            document.getElementById('detail-advice').innerText = chat.advice;

            // 填充消息
            const msgContainer = document.getElementById('detail-messages');
            msgContainer.innerHTML = ''; // 清空
            
            chat.messages.forEach(msg => {
                const isKf = msg.role === '客服';
                const msgDiv = document.createElement('div');
                msgDiv.className = `flex ${isKf ? 'justify-end' : 'justify-start'}`;
                
                msgDiv.innerHTML = `
                    <div class="max-w-[85%] rounded-lg p-3 text-sm shadow-sm ${isKf ? 'chat-bubble-kf' : 'chat-bubble-user'}">
                        <p class="text-xs opacity-70 mb-1 flex items-center gap-1">
                            ${isKf ? '<i data-lucide="headset" class="w-3 h-3"></i>' : '<i data-lucide="user" class="w-3 h-3"></i>'} 
                            ${msg.role}
                        </p>
                        <p>${msg.content}</p>
                    </div>
                `;
                msgContainer.appendChild(msgDiv);
            });

            // 重新渲染新插入元素的图标
            lucide.createIcons();
        }

        function closeDetail() {
            document.getElementById('chat-detail-container').classList.add('hidden');
            document.getElementById('empty-state').classList.remove('hidden');
        }

        // 初始化图标
        lucide.createIcons();

    </script>
</body>
</html>